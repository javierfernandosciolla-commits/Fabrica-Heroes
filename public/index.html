<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F√°brica de H√©roes - Crea tu Aventura</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 50%, #1e40af 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse-glow {
            0%, 100% {
                box-shadow: 0 0 20px rgba(251, 146, 60, 0.5);
            }
            50% {
                box-shadow: 0 0 40px rgba(251, 146, 60, 0.8);
            }
        }

        @keyframes spin-slow {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes shimmer {
            0% {
                background-position: -1000px 0;
            }
            100% {
                background-position: 1000px 0;
            }
        }

        .fade-in-up {
            animation: fadeInUp 0.6s ease-out;
        }

        .pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }

        .spin-slow {
            animation: spin-slow 3s linear infinite;
        }

        .loading-bar {
            height: 4px;
            background: linear-gradient(90deg, transparent, #fb923c, transparent);
            background-size: 1000px 100%;
            animation: shimmer 2s infinite;
        }

        .hero-gradient {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 50%, #60a5fa 100%);
        }

        .orange-accent {
            color: #fb923c;
        }

        .btn-primary {
            background: linear-gradient(135deg, #fb923c 0%, #f97316 100%);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(251, 146, 60, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(251, 146, 60, 0.5);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .input-field {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .input-field:focus {
            border-color: #fb923c;
            box-shadow: 0 0 0 3px rgba(251, 146, 60, 0.1);
        }

        .card-hero {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .screen {
            display: none;
            min-height: 100vh;
            padding: 20px;
            animation: fadeInUp 0.6s ease-out;
        }

        .screen.active {
            display: flex;
        }

        .container-app {
            max-width: 500px;
            margin: 0 auto;
            width: 100%;
        }

        .text-glow {
            text-shadow: 0 0 20px rgba(251, 146, 60, 0.3);
        }

        .badge-hero {
            display: inline-block;
            background: linear-gradient(135deg, #fb923c, #f97316);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            color: white;
            margin-bottom: 10px;
        }

        .story-preview {
            background: linear-gradient(135deg, rgba(30, 64, 175, 0.1), rgba(251, 146, 60, 0.1));
            border-left: 4px solid #fb923c;
            padding: 20px;
            border-radius: 10px;
            line-height: 1.8;
            font-size: 16px;
            color: #1e3a8a;
            margin: 20px 0;
        }

        .image-placeholder {
            width: 100%;
            height: 300px;
            background: linear-gradient(135deg, #1e40af, #3b82f6, #60a5fa);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            text-align: center;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .image-placeholder img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .lock-icon {
            display: inline-block;
            margin-right: 8px;
        }

        .error-message {
            background: #fee2e2;
            border: 1px solid #fca5a5;
            color: #991b1b;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: none;
        }

        .success-message {
            background: #dcfce7;
            border: 1px solid #86efac;
            color: #166534;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: none;
        }

        @media (max-width: 640px) {
            .container-app {
                max-width: 100%;
            }

            .screen {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- PANTALLA 1: BIENVENIDA -->
    <div id="welcomeScreen" class="screen active">
        <div class="container-app flex flex-col justify-center items-center h-full">
            <div class="text-center fade-in-up">
                <div class="mb-8">
                    <div class="inline-block text-6xl mb-4">ü¶∏</div>
                </div>

                <h1 class="text-5xl font-black text-white mb-4 text-glow">
                    F√°brica de H√©roes
                </h1>

                <p class="text-xl text-orange-300 mb-8 font-semibold leading-relaxed">
                    Convierte a tu hijo/a en el protagonista de su propia pel√≠cula
                </p>

                <p class="text-white text-opacity-90 mb-12 text-base leading-relaxed">
                    Crea historias √©picas personalizadas donde tu peque√±o es el h√©roe. Aventuras m√°gicas, superpoderes incre√≠bles y villanos que vencer.
                </p>

                <button 
                    id="createAdventureBtn" 
                    class="btn-primary w-full py-4 px-6 rounded-xl text-white font-bold text-lg mb-6 pulse-glow"
                >
                    ‚ú® Crear Aventura
                </button>

                <div class="grid grid-cols-3 gap-4 mt-12 text-white text-sm">
                    <div class="bg-white bg-opacity-10 p-4 rounded-lg backdrop-blur">
                        <div class="text-2xl mb-2">üìñ</div>
                        <p class="text-xs">Historias √önicas</p>
                    </div>
                    <div class="bg-white bg-opacity-10 p-4 rounded-lg backdrop-blur">
                        <div class="text-2xl mb-2">üé®</div>
                        <p class="text-xs">Im√°genes IA</p>
                    </div>
                    <div class="bg-white bg-opacity-10 p-4 rounded-lg backdrop-blur">
                        <div class="text-2xl mb-2">üì•</div>
                        <p class="text-xs">PDF Descargable</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- PANTALLA 2: FORMULARIO DE DATOS -->
    <div id="formScreen" class="screen">
        <div class="container-app flex flex-col justify-center items-center min-h-screen">
            <div class="w-full">
                <div class="mb-8 text-center">
                    <button id="backFromForm" class="text-white text-2xl mb-4 hover:text-orange-300 transition">
                        ‚Üê Atr√°s
                    </button>
                    <h2 class="text-3xl font-black text-white mb-2">Crea tu H√©roe</h2>
                    <p class="text-white text-opacity-80">Cu√©ntanos sobre tu protagonista</p>
                </div>

                <div class="card-hero p-8 mb-8">
                    <div id="errorMessage" class="error-message"></div>

                    <form id="heroForm">
                        <div class="mb-6">
                            <label class="block text-sm font-bold text-gray-800 mb-3">
                                üìù Nombre del H√©roe
                            </label>
                            <input 
                                type="text" 
                                id="heroName" 
                                placeholder="Ej: Luna, Mateo, Sofia..." 
                                class="input-field w-full px-4 py-3 rounded-lg focus:outline-none"
                                required
                            >
                        </div>

                        <div class="mb-6">
                            <label class="block text-sm font-bold text-gray-800 mb-3">
                                üéÇ Edad del H√©roe
                            </label>
                            <input 
                                type="number" 
                                id="heroAge" 
                                placeholder="Ej: 7, 8, 9..." 
                                min="3" 
                                max="18"
                                class="input-field w-full px-4 py-3 rounded-lg focus:outline-none"
                                required
                            >
                        </div>

                        <div class="mb-6">
                            <label class="block text-sm font-bold text-gray-800 mb-3">
                                ‚ö° Superpoder
                            </label>
                            <input 
                                type="text" 
                                id="superpower" 
                                placeholder="Ej: Volar, Fuerza sobrehumana, Magia..." 
                                class="input-field w-full px-4 py-3 rounded-lg focus:outline-none"
                                required
                            >
                        </div>

                        <div class="mb-8">
                            <label class="block text-sm font-bold text-gray-800 mb-3">
                                üëπ Villano o Miedo a Vencer
                            </label>
                            <input 
                                type="text" 
                                id="villain" 
                                placeholder="Ej: El Drag√≥n de Hielo, La Oscuridad..." 
                                class="input-field w-full px-4 py-3 rounded-lg focus:outline-none"
                                required
                            >
                        </div>

                        <button 
                            type="submit" 
                            id="generateBtn"
                            class="btn-primary w-full py-4 px-6 rounded-xl text-white font-bold text-lg"
                        >
                            üöÄ Generar Mi Aventura
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- PANTALLA 3: CARGA/GENERACI√ìN -->
    <div id="loadingScreen" class="screen">
        <div class="container-app flex flex-col justify-center items-center h-full">
            <div class="text-center">
                <div class="mb-8">
                    <div class="inline-block text-6xl spin-slow">‚ú®</div>
                </div>

                <h2 class="text-3xl font-black text-white mb-8">Creando tu Aventura...</h2>

                <div class="mb-8 bg-white bg-opacity-20 rounded-full h-2 overflow-hidden">
                    <div class="loading-bar h-full"></div>
                </div>

                <div class="space-y-3 mb-8">
                    <p id="loadingMsg1" class="text-white text-opacity-90 flex items-center justify-center">
                        <span class="inline-block w-2 h-2 bg-orange-400 rounded-full mr-3 animate-pulse"></span>
                        Analizando superpoderes...
                    </p>
                    <p id="loadingMsg2" class="text-white text-opacity-60 flex items-center justify-center">
                        <span class="inline-block w-2 h-2 bg-orange-400 rounded-full mr-3"></span>
                        Escribiendo destino...
                    </p>
                    <p id="loadingMsg3" class="text-white text-opacity-40 flex items-center justify-center">
                        <span class="inline-block w-2 h-2 bg-orange-400 rounded-full mr-3"></span>
                        Generando im√°genes m√°gicas...
                    </p>
                </div>

                <p class="text-white text-opacity-70 text-sm">Esto tomar√° unos segundos...</p>
            </div>
        </div>
    </div>

    <!-- PANTALLA 4: RESULTADO Y GANCHO DE MONETIZACI√ìN -->
    <div id="resultScreen" class="screen">
        <div class="container-app flex flex-col justify-center items-center min-h-screen">
            <div class="w-full">
                <div class="mb-6 text-center">
                    <button id="backFromResult" class="text-white text-2xl mb-4 hover:text-orange-300 transition">
                        ‚Üê Atr√°s
                    </button>
                    <h2 class="text-3xl font-black text-white mb-2">Tu Aventura Est√° Lista</h2>
                </div>

                <div class="card-hero p-8 mb-8">
                    <div id="successMessage" class="success-message"></div>

                    <div class="text-center mb-6">
                        <div class="badge-hero">ü¶∏ Tu H√©roe</div>
                        <h3 class="text-3xl font-black text-gray-900 mb-2" id="resultHeroName">
                            Luna
                        </h3>
                        <p class="text-gray-600 text-sm" id="resultHeroDetails">
                            7 a√±os ‚Ä¢ Superpoder: Volar ‚Ä¢ Villano: El Drag√≥n de Hielo
                        </p>
                    </div>

                    <div class="mb-8">
                        <div class="image-placeholder" id="heroImage">
                            <div class="text-center">
                                <div class="text-4xl mb-3">üé®</div>
                                <p>Generando imagen...</p>
                                <p class="text-xs text-white text-opacity-70 mt-2">Imagen generada por IA</p>
                            </div>
                        </div>
                    </div>

                    <div class="mb-8">
                        <div class="flex items-center mb-4">
                            <span class="text-green-500 font-bold text-sm">‚úì GRATIS</span>
                            <h4 class="text-lg font-bold text-gray-900 ml-3">Primeras L√≠neas de tu Historia</h4>
                        </div>
                        <div class="story-preview" id="storyPreview">
                            <p id="storyText">
                                Cargando historia...
                            </p>
                            <p class="text-center text-gray-700 font-bold mt-4 text-orange-600">
                                [Contin√∫a en la versi√≥n completa...]
                            </p>
                        </div>
                    </div>

                    <button 
                        id="paymentBtn" 
                        class="btn-primary w-full py-4 px-6 rounded-xl text-white font-bold text-lg text-center block mb-4 pulse-glow"
                    >
                        <span class="lock-icon">üîì</span>Desbloquear Aventura Completa por $1.000 ARS
                    </button>

                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded mb-6">
                        <p class="font-bold text-blue-900 mb-3">En la versi√≥n completa obtendr√°s:</p>
                        <ul class="text-sm text-blue-800 space-y-2">
                            <li>‚úì Historia completa (5-7 p√°ginas)</li>
                            <li>‚úì Imagen HD generada por IA</li>
                            <li>‚úì PDF descargable para imprimir</li>
                            <li>‚úì Acceso de por vida</li>
                        </ul>
                    </div>

                    <button 
                        id="shareBtn" 
                        class="w-full py-3 px-6 rounded-xl border-2 border-gray-300 text-gray-700 font-bold hover:bg-gray-50 transition"
                    >
                        üì§ Compartir con Familia
                    </button>
                </div>

                <div class="text-center">
                    <button 
                        id="createAnotherBtn" 
                        class="text-white hover:text-orange-300 transition font-semibold"
                    >
                        Crear otra aventura ‚Üí
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuraci√≥n
        const API_BASE_URL = window.location.origin + '/api'; // Autom√°ticamente usa el dominio actual
        
        let appState = {
            heroName: '',
            heroAge: '',
            superpower: '',
            villain: '',
            storyPreview: '',
            story: '',
            heroImageUrl: '',
            email: ''
        };

        // Funciones auxiliares
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
            window.scrollTo(0, 0);
        }

        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
            setTimeout(() => {
                errorEl.style.display = 'none';
            }, 5000);
        }

        function showSuccess(message) {
            const successEl = document.getElementById('successMessage');
            successEl.textContent = message;
            successEl.style.display = 'block';
            setTimeout(() => {
                successEl.style.display = 'none';
            }, 5000);
        }

        async function generateStory() {
            try {
                showScreen('loadingScreen');

                const response = await axios.post(`${API_BASE_URL}/story/generate`, {
                    heroName: appState.heroName,
                    heroAge: appState.heroAge,
                    superpower: appState.superpower,
                    villain: appState.villain
                });

                appState.story = response.data.story;
                appState.heroImageUrl = response.data.image;

                // Generar preview (primer p√°rrafo)
                const previewResponse = await axios.post(`${API_BASE_URL}/story/preview`, {
                    heroName: appState.heroName,
                    heroAge: appState.heroAge,
                    superpower: appState.superpower,
                    villain: appState.villain
                });

                appState.storyPreview = previewResponse.data.preview;

                setTimeout(() => {
                    showScreen('resultScreen');
                    updateResultScreen();
                }, 2000);
            } catch (error) {
                console.error('Error generando historia:', error);
                showError('Error generando la historia. Intenta de nuevo.');
                showScreen('formScreen');
            }
        }

        function updateResultScreen() {
            document.getElementById('resultHeroName').textContent = appState.heroName;
            
            const details = `${appState.heroAge} a√±os ‚Ä¢ Superpoder: ${appState.superpower} ‚Ä¢ Villano: ${appState.villain}`;
            document.getElementById('resultHeroDetails').textContent = details;
            
            document.getElementById('storyText').textContent = appState.storyPreview;
            
            const imageContainer = document.getElementById('heroImage');
            if (appState.heroImageUrl) {
                imageContainer.innerHTML = `<img src="${appState.heroImageUrl}" alt="${appState.heroName}" style="width: 100%; height: 100%; object-fit: cover;">`;
            }
        }

        async function handlePayment() {
            try {
                // Solicitar email al usuario
                const email = prompt('Por favor, ingresa tu email para recibir la historia:');
                if (!email) return;

                appState.email = email;

                // Crear preferencia de pago
                const response = await axios.post(`${API_BASE_URL}/payment/create-preference`, {
                    heroName: appState.heroName,
                    heroAge: appState.heroAge,
                    superpower: appState.superpower,
                    villain: appState.villain,
                    email: email
                });

                // Redirigir a MercadoPago
                if (response.data.initPoint) {
                    window.location.href = response.data.initPoint;
                } else {
                    showError('Error al crear la preferencia de pago');
                }
            } catch (error) {
                console.error('Error en pago:', error);
                showError('Error procesando el pago. Intenta de nuevo.');
            }
        }

        function shareStory() {
            const text = `¬°Acabo de crear la aventura de ${appState.heroName}! ü¶∏ Descubre historias √©picas personalizadas en F√°brica de H√©roes. ‚ú®`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'F√°brica de H√©roes',
                    text: text,
                    url: window.location.href
                }).catch(err => console.log('Error al compartir:', err));
            } else {
                navigator.clipboard.writeText(text).then(() => {
                    showSuccess('¬°Texto copiado! Puedes compartirlo en tus redes sociales.');
                });
            }
        }

        // Event Listeners
        document.getElementById('createAdventureBtn').addEventListener('click', () => {
            showScreen('formScreen');
        });

        document.getElementById('backFromForm').addEventListener('click', () => {
            showScreen('welcomeScreen');
        });

        document.getElementById('heroForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            appState.heroName = document.getElementById('heroName').value.trim();
            appState.heroAge = document.getElementById('heroAge').value;
            appState.superpower = document.getElementById('superpower').value.trim();
            appState.villain = document.getElementById('villain').value.trim();
            
            if (!appState.heroName || !appState.heroAge || !appState.superpower || !appState.villain) {
                showError('Por favor completa todos los campos');
                return;
            }

            generateStory();
        });

        document.getElementById('backFromResult').addEventListener('click', () => {
            showScreen('welcomeScreen');
            document.getElementById('heroForm').reset();
        });

        document.getElementById('paymentBtn').addEventListener('click', handlePayment);

        document.getElementById('shareBtn').addEventListener('click', shareStory);

        document.getElementById('createAnotherBtn').addEventListener('click', () => {
            showScreen('welcomeScreen');
            document.getElementById('heroForm').reset();
        });

        console.log('ü¶∏ F√°brica de H√©roes - Frontend Iniciado');
        console.log('üì° API Base URL:', API_BASE_URL);
    </script>
</body>
</html>
